# DotApp JavaScript Framework

**DotApp** is a lightweight, secure, and intuitive JavaScript framework that is an integral part of the **DotApp PHP Framework**. It is designed for fast and secure connection between frontend (FE) and backend (BE) using the `dotbridge` mechanism, managing reactive data, and simple DOM manipulation. The framework is optimized exclusively for use with the DotApp PHP framework and is not intended for standalone use outside of it.

**Author**: Štefan Miščík  
**Web**: [dotsystems.sk](https://dotsystems.sk)  
**Email**: info@dotsystems.sk  
**Version**: 1.0 (stable)  
**License**: MIT License

## Key Features
- **Dotbridge**: Secure bridge between FE and BE with CRC check, base64 encoding, dynamic ID regeneration, and input validation.
- **Reactive variables**: Simple data management with automatic storage and binding to DOM elements.
- **Intuitive API**: Inspired by jQuery, with chainable methods like `html`, `attr`, `addClass`.
- **Advanced event handling**: Support for custom events such as `bodychange`, `attrchange`, `visibilitychange`.
- **Minimal overhead**: Compact code optimized for speed and low resource consumption.
- **Robust loading**: Support for asynchronous script loading, preventing errors like "$dotapp is undefined".
- **Integration with DotApp PHP**: Close binding to PHP backend for seamless communication and security.

> **Note**: DotApp JavaScript framework is designed exclusively for use with DotApp PHP framework. A PHP backend that dynamically generates `dotapp.js` and provides necessary security keys is essential for its operation.

## Installation

DotApp JavaScript framework is integrated with DotApp PHP framework. To use it, follow these steps:

1. **Install DotApp PHP Framework**:
   - Make sure you have installed and configured DotApp PHP framework according to its documentation.
   - The PHP framework provides a router that dynamically generates `dotapp.js` at the path `/assets/dotapp/dotapp.js`.

2. **Add DotApp JavaScript to HTML**:
   - Insert the script into your template using the fixed path:
     ```html
     &lt;script src="/assets/dotapp/dotapp.js">&lt;/script>
     ```
   - This script is generated by the DotApp PHP framework router and contains the necessary security keys.

3. **Create a user script**:
   - Create your own JavaScript file (e.g., `custom.js`) to define frontend logic.
   - Use the recommended loading method to ensure the script runs regardless of the loading order of `dotapp.js`:
     ```javascript
     (function() {
         var function = function($dotapp) {
             // Your logic here
             console.log('DotApp initialized!');
         };

         if (window.$dotapp) {
             function(window.$dotapp);
         } else {
             window.addEventListener('dotapp', function() {
                 function(window.$dotapp);
             }, { once: true });
         }
     })();
     ```
   - This code ensures that your script runs only after `dotapp.js` has loaded, avoiding errors like "$dotapp is undefined".

4. **Add the user script to HTML**:
   - Insert your `custom.js` into the template:
     ```html
    &lt;script src="/path/to/custom.js">&lt;/script>
     ```

> **Important**: Always use the recommended loading method (as in the example above) to ensure robustness and flexibility when loading scripts. This approach allows loading `custom.js` before or after `dotapp.js`.

## Basic Usage

DotApp JavaScript framework provides an intuitive API for DOM manipulation, reactive data management, and secure connection with DotApp PHP backend. Here is an overview of key functions:

### 1. DOM Manipulation
DotApp supports chainable methods inspired by jQuery for easy work with DOM:
```javascript
$dotapp('.my-div')
    .html('Hello, world!')
    .addClass('active')
    .attr('data-id', '123');
```

### 2. Reactive Variables
Create variables that automatically synchronize with DOM and react to changes:
```javascript
$dotapp().variable('username', 'John');
const user = $dotapp().getVariable('username');
user.bindToElement(document.querySelector('#user-input'));
user.onChange((oldValue, newValue) => {
    console.log(`Value changed from ${oldValue} to ${newValue}`);
});
user.value = 'Jane'; // Updates input and triggers callback
```

### 3. Dotbridge (FE-BE Connection)
The `dotbridge` mechanism allows secure sending of data to DotApp PHP backend with input validation:
```javascript
$dotapp()
    .bridge('dotcms.newsletter', 'click')
    .before((data, element) => {
        element.querySelector('.loader').classList.add('display');
    })
    .onValueError((inputname, element) => {
        element.querySelector('.loader').classList.remove('display');
        alert('Invalid input!');
    })
    .after((data, element) => {
        element.querySelector('.loader').classList.remove('display');
        if ($dotapp().isSet(data['status']) && data['status'] == 1) {
            element.parentElement.querySelector('small').innerHTML = data['status_txt'];
        }
    });
```

### 4. Custom Events

DotApp provides advanced tracking of custom events that allow reacting to changes in DOM, such as changes in content, attributes, size, position, visibility, or event statistics. Here are examples for each supported event:

#### 4.1. `bodychange`

Tracks changes in element content (e.g., text or HTML) using `MutationObserver`.

**Example**:
```javascript
$dotapp('.my-div').on('bodychange', (element, oldContent, newContent) => {
    console.log(`Content changed from "${oldContent}" to "${newContent}"`);
});
```

**HTML**:
```html
<div class="my-div">Original content</div>
<button onclick="document.querySelector('.my-div').innerHTML = 'New content'">Change content</button>
```

**Explanation**: When the content of the `.my-div` element changes (e.g., by clicking the button), the callback is triggered, which displays the old and new content.

#### 4.2. `attrchange`

Tracks changes in element attributes (e.g., `class`, `data-*`) using `MutationObserver`.

**Example**:
```javascript
$dotapp('.my-div').on('attrchange:class', (element, attrName, oldValue, newValue) => {
    console.log(`Attribute ${attrName} changed from "${oldValue}" to "${newValue}"`);
});
```

**HTML**:
```html
<div class="my-div">Content</div>
<button onclick="document.querySelector('.my-div').className = 'new-class'">Change class</button>
```

**Explanation**: When the `class` attribute of the `.my-div` element changes, the callback is triggered. You can specify a specific attribute (e.g., `attrchange:class`) or track all attributes using `attrchange`.

#### 4.3. `resizechange`

Tracks changes in element size (width or height) using `ResizeObserver`.

**Example**:
```javascript
$dotapp('.my-div').on('resizechange', (element, oldSize, newSize) => {
    console.log(`Size changed from ${oldSize.width}x${oldSize.height} to ${newSize.width}x${newSize.height}`);
});
```

**HTML**:
```html
<div class="my-div" style="width: 200px; height: 100px; resize: both; overflow: auto;">Content</div>
```

**Explanation**: When the size of the `.my-div` element changes (e.g., by manual resizing), the callback is triggered, which displays the old and new dimensions. The element must have `resize: both` and `overflow: auto` for manual resizing.

#### 4.4. `positionchange`

Tracks changes in element position (e.g., `offsetTop`, `offsetLeft`) when scrolling or changing layout.

**Example**:
```javascript
$dotapp('.my-div').on('positionchange', (element, oldPosition, newPosition) => {
    console.log(`Position changed from top:${oldPosition.top},left:${oldPosition.left} to top:${newPosition.top},left:${newPosition.left}`);
});
```

**HTML**:
```html
<div style="height: 1000px;"></div>
<div class="my-div" style="position: relative;">Content</div>
<button onclick="document.querySelector('.my-div').style.marginTop = '100px'">Move</button>
```

**Explanation**: When the position of the `.my-div` element changes (e.g., by changing margin or scrolling the page), the callback is triggered, which displays the old and new position.

#### 4.5. `visibilitychange`

Tracks changes in element visibility (whether it is in the viewport) using `IntersectionObserver`.

**Example**:
```javascript
$dotapp('.my-div').on('visibilitychange', (element, isVisible) => {
    console.log(`Element is ${isVisible ? 'visible' : 'invisible'}`);
});
```

**HTML**:
```html
<div style="height: 1000px;"></div>
<div class="my-div">Content</div>
```

**Explanation**: When scrolling the page, when the `.my-div` element enters or exits the viewport, the callback is triggered, which displays the visibility status.

#### 4.6. `eventwatch`

Tracks event statistics (e.g., number of clicks, time of last occurrence) on an element.

**Example**:
```javascript
$dotapp('.my-div').on('eventwatch', { eventType: 'click' }, (element, event, stats) => {
    console.log(`Click number ${stats.count}, last at ${stats.lastTime}`);
});
```

**HTML**:
```html
<div class="my-div">Click here</div>
```

**Explanation**: With each click on the `.my-div` element, the callback is triggered, which displays the number of clicks and the time of the last click. Statistics are stored in the `stats` object.

---

# DotApp JavaScript Framework

**DotApp** je ľahký, bezpečný a intuitívny JavaScriptový framework, ktorý je neoddeliteľnou súčasťou **DotApp PHP Frameworku**. Je navrhnutý na rýchle a bezpečné prepojenie frontendu (FE) s backendom (BE) pomocou mechanizmu `dotbridge`, správu reaktívnych dát a jednoduchú manipuláciu s DOM. Framework je optimalizovaný výlučne pre použitie s DotApp PHP frameworkom a nie je určený na samostatné použitie mimo neho.

**Autor**: Štefan Miščík  
**Web**: [dotsystems.sk](https://dotsystems.sk)  
**Email**: info@dotsystems.sk  
**Verzia**: 1.0 (stabilná)  
**Licencia**: MIT License

## Kľúčové vlastnosti
- **Dotbridge**: Bezpečný most medzi FE a BE s CRC kontrolou, base64 kódovaním, dynamickou regeneráciou ID a validáciou vstupov.
- **Reaktívne premenné**: Jednoduchá správa dát s automatickým ukladaním a väzbou na DOM elementy.
- **Intuitívne API**: Inšpirované jQuery, s reťaziteľnými metódami ako `html`, `attr`, `addClass`.
- **Pokročilé event handling**: Podpora vlastných udalostí ako `bodychange`, `attrchange`, `visibilitychange`.
- **Minimálna réžia**: Kompaktný kód optimalizovaný pre rýchlosť a nízku spotrebu zdrojov.
- **Robustné načítanie**: Podpora asynchrónneho načítania skriptov, čím sa predchádza chybám typu „$dotapp is undefined".
- **Integrácia s DotApp PHP**: Úzka väzba na PHP backend pre bezproblémovú komunikáciu a bezpečnosť.

> **Poznámka**: DotApp JavaScript framework je navrhnutý výlučne pre použitie s DotApp PHP frameworkom. Na jeho fungovanie je nevyhnutný PHP backend, ktorý dynamicky generuje `dotapp.js` a poskytuje potrebné bezpečnostné kľúče.

## Inštalácia

DotApp JavaScript framework je integrovaný s DotApp PHP frameworkom. Na použitie postupujte takto:

1. **Nainštalujte DotApp PHP Framework**:
   - Uistite sa, že máte nainštalovaný a nakonfigurovaný DotApp PHP framework podľa jeho dokumentácie.
   - PHP framework poskytuje router, ktorý dynamicky generuje `dotapp.js` na ceste `/assets/dotapp/dotapp.js`.

2. **Pridajte DotApp JavaScript do HTML**:
   - Vložte skript do vašej šablóny pomocou pevne definovanej cesty:
     ```html
     &lt;script src="/assets/dotapp/dotapp.js">&lt;/script>
     ```
   - Tento skript je generovaný routerom DotApp PHP frameworku a obsahuje potrebné bezpečnostné kľúče.

3. **Vytvorte používateľský skript**:
   - Vytvorte vlastný JavaScript súbor (napr. `custom.js`) na definovanie frontendovej logiky.
   - Použite odporúčaný spôsob načítania, aby ste zabezpečili, že skript sa spustí bez ohľadu na poradie načítania `dotapp.js`:
     ```javascript
     (function() {
         var funkcia = function($dotapp) {
             // Vaša logika tu
             console.log('DotApp inicializovaný!');
         };

         if (window.$dotapp) {
             funkcia(window.$dotapp);
         } else {
             window.addEventListener('dotapp', function() {
                 funkcia(window.$dotapp);
             }, { once: true });
         }
     })();
     ```
   - Tento kód zaisťuje, že váš skript sa spustí až po načítaní `dotapp.js`, čím sa vyhnete chybám typu „$dotapp is undefined".

4. **Pridajte používateľský skript do HTML**:
   - Vložte váš `custom.js` do šablóny:
     ```html
    &lt;script src="/path/to/custom.js">&lt;/script>
     ```

> **Dôležité**: Vždy používajte odporúčaný spôsob načítania (ako v príklade vyššie), aby ste zaistili robustnosť a flexibilitu pri načítavaní skriptov. Tento prístup umožňuje načítanie `custom.js` pred alebo po `dotapp.js`.

## Základné použitie

DotApp JavaScript framework poskytuje intuitívne API na manipuláciu s DOM, správu reaktívnych dát a bezpečné prepojenie s DotApp PHP backendom. Tu je prehľad kľúčových funkcií:

### 1. Manipulácia s DOM
DotApp podporuje reťaziteľné metódy inšpirované jQuery pre jednoduchú prácu s DOM:
```javascript
$dotapp('.my-div')
    .html('Ahoj, svet!')
    .addClass('active')
    .attr('data-id', '123');
```

### 2. Reaktívne premenné
Vytvorte premenné, ktoré sa automaticky synchronizujú s DOM a reagujú na zmeny:
```javascript
$dotapp().variable('username', 'John');
const user = $dotapp().getVariable('username');
user.bindToElement(document.querySelector('#user-input'));
user.onChange((oldValue, newValue) => {
    console.log(`Hodnota sa zmenila z ${oldValue} na ${newValue}`);
});
user.value = 'Jane'; // Aktualizuje input a spustí callback
```

### 3. Dotbridge (prepojenie FE-BE)
Mechanizmus `dotbridge` umožňuje bezpečné odosielanie dát na DotApp PHP backend s validáciou vstupov:
```javascript
$dotapp()
    .bridge('dotcms.newsletter', 'click')
    .before((data, element) => {
        element.querySelector('.loader').classList.add('display');
    })
    .onValueError((inputname, element) => {
        element.querySelector('.loader').classList.remove('display');
        alert('Neplatný vstup!');
    })
    .after((data, element) => {
        element.querySelector('.loader').classList.remove('display');
        if ($dotapp().isSet(data['status']) && data['status'] == 1) {
            element.parentElement.querySelector('small').innerHTML = data['status_txt'];
        }
    });
```

### 4. Vlastné udalosti

DotApp poskytuje pokročilé sledovanie vlastných udalostí, ktoré umožňujú reagovať na zmeny v DOM, ako sú zmeny obsahu, atribútov, veľkosti, pozície, viditeľnosti alebo štatistiky udalostí. Nasledujú príklady pre každú podporovanú udalosť:

#### 4.1. `bodychange`

Sleduje zmeny obsahu elementu (napr. textu alebo HTML) pomocou `MutationObserver`.

**Príklad**:
```javascript
$dotapp('.my-div').on('bodychange', (element, oldContent, newContent) => {
    console.log(`Obsah sa zmenil z "${oldContent}" na "${newContent}"`);
});
```

**HTML**:
```html
<div class="my-div">Pôvodný obsah</div>
<button onclick="document.querySelector('.my-div').innerHTML = 'Nový obsah'">Zmeniť obsah</button>
```

**Vysvetlenie**: Pri zmene obsahu elementu `.my-div` (napr. kliknutím na tlačidlo) sa spustí callback, ktorý vypíše starý a nový obsah.

#### 4.2. `attrchange`

Sleduje zmeny atribútov elementu (napr. `class`, `data-*`) pomocou `MutationObserver`.

**Príklad**:
```javascript
$dotapp('.my-div').on('attrchange:class', (element, attrName, oldValue, newValue) => {
    console.log(`Atribút ${attrName} sa zmenil z "${oldValue}" na "${newValue}"`);
});
```

**HTML**:
```html
<div class="my-div">Obsah</div>
<button onclick="document.querySelector('.my-div').className = 'new-class'">Zmeniť triedu</button>
```

**Vysvetlenie**: Pri zmene atribútu `class` elementu `.my-div` sa spustí callback. Môžete špecifikovať konkrétny atribút (napr. `attrchange:class`) alebo sledovať všetky atribúty pomocou `attrchange`.

#### 4.3. `resizechange`

Sleduje zmeny veľkosti elementu (šírka alebo výška) pomocou `ResizeObserver`.

**Príklad**:
```javascript
$dotapp('.my-div').on('resizechange', (element, oldSize, newSize) => {
    console.log(`Veľkosť sa zmenila z ${oldSize.width}x${oldSize.height} na ${newSize.width}x${newSize.height}`);
});
```

**HTML**:
```html
<div class="my-div" style="width: 200px; height: 100px; resize: both; overflow: auto;">Obsah</div>
```

**Vysvetlenie**: Pri zmene veľkosti elementu `.my-div` (napr. manuálnym resizovaním) sa spustí callback, ktorý vypíše staré a nové rozmery. Element musí mať `resize: both` a `overflow: auto` pre manuálne resizovanie.

#### 4.4. `positionchange`

Sleduje zmeny pozície elementu (napr. `offsetTop`, `offsetLeft`) pri posúvaní alebo zmene rozloženia.

**Príklad**:
```javascript
$dotapp('.my-div').on('positionchange', (element, oldPosition, newPosition) => {
    console.log(`Pozícia sa zmenila z top:${oldPosition.top},left:${oldPosition.left} na top:${newPosition.top},left:${newPosition.left}`);
});
```

**HTML**:
```html
<div style="height: 1000px;"></div>
<div class="my-div" style="position: relative;">Obsah</div>
<button onclick="document.querySelector('.my-div').style.marginTop = '100px'">Posunúť</button>
```

**Vysvetlenie**: Pri zmene pozície elementu `.my-div` (napr. zmenou margin alebo posunom stránky) sa spustí callback, ktorý vypíše starú a novú pozíciu.

#### 4.5. `visibilitychange`

Sleduje zmeny viditeľnosti elementu (či je v zornom poli) pomocou `IntersectionObserver`.

**Príklad**:
```javascript
$dotapp('.my-div').on('visibilitychange', (element, isVisible) => {
    console.log(`Element je ${isVisible ? 'viditeľný' : 'neviditeľný'}`);
});
```

**HTML**:
```html
<div style="height: 1000px;"></div>
<div class="my-div">Obsah</div>
```

**Vysvetlenie**: Pri posúvaní stránky, keď element `.my-div` vstúpi alebo vystúpi zo zorného poľa, sa spustí callback, ktorý vypíše stav viditeľnosti.

#### 4.6. `eventwatch`

Sleduje štatistiky udalostí (napr. počet kliknutí, čas posledného výskytu) na elemente.

**Príklad**:
```javascript
$dotapp('.my-div').on('eventwatch', { eventType: 'click' }, (element, event, stats) => {
    console.log(`Kliknutie číslo ${stats.count}, posledné o ${stats.lastTime}`);
});
```

**HTML**:
```html
<div class="my-div">Kliknite sem</div>
```

**Vysvetlenie**: Pri každom kliknutí na element `.my-div` sa spustí callback, ktorý vypíše počet kliknutí a čas posledného kliknutia. Štatistiky sú uložené v objekte `stats`.
